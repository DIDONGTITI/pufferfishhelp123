---
layout: layouts/article.html
title: "Security audit by Trail of Bits, the new website and v4.2 released"
date: 2022-09-28
permalink: "/blog/20221108-simplex-chat-v4.2-security-audit-new-website.html"
---

# Security audit by Trail of Bits, the new website and v4.2 released

**Published:** Nov 8, 2022

Please note: This is work in progress to reserve permalink, to be published on November 8

## Security audit by Trail of Bits

When we first launched the app in March the common question on Reddit was: "Have you been audited or should we just ignore you?".

We had a growing number of enthusiasts using the app who can accept the security risks of unaudited system, the users who depend on their security were patiently waiting until some independent experts validate our claims.

Trail of Bits, a US based security and technology consultancy whose clients include big tech companies, governmental agencies and major blockchain projects, had 2 engineers reviewing SimpleX Chat, specifically [simplexmq library](https://github.com/simplex-chat/simplexmq) that is responsible for all cryptography and networking of SimpleX Chat.

2 medium and 2 low severity issues were identified, all of which would require at least a high difficulty of attack â€“ the attacked would need to have privileged access to the system, may need to know complex technical details, or must discover other weaknesses to exploit them. 3 of these issues are already fixed in v4.2.

Overall we have SimpleX Chat in a decent shape, with most reviewed areas other than identified issues being "satisfactory" and authentication and access controls being "strong".

The issues are explained below, and the full security review is available via [this link](https://github.com/trailofbits/publications#security-reviews).

We are hugely thankful for Trails Of Bits for the work they did, helping us identify these issues and strengthening the security of SimpleX Chat.

### Medium severity issues

##### X3DH key exchange for double ratchet protocol

We made a mistake in implementing X3DH key exchange - the key derivation function was not applied to the result of concatenation of 3 DH operations. The attack to exploit this mistake has high complexity, as it would require compromising one of private keys generated by the clients, and also it would only affect forward secrecy until break-in recovery happens (after both sides sent some messages).

Please note that SimpleX does not perform X3DH with long-term identity keys, as the SimpleX protocol does not rely on long-term keys to identify client devices. Therefore, the impact of compromising a key will be less severe, as it will affect only the secrets of the connection where the key was compromised.

This issue is fixed in version 4.2 in [this PR](https://github.com/simplex-chat/simplexmq/pull/548/files), and if both clients are updated the key exchange will not have this vulnerability. Also, previously created connections should be secure as long as both sides sent the messages, but if you believe that your private key(s) could have been compromised (for example, if you used SimpleX Chat since before we added database encryption), I recommend that you create the new connections with your contacts, at least with your security critical contacts. Simply rotating the connection queue that was added in version 4.2 will not be sufficient, as this rotation does not re-initialize the ratchets - this is something we will be adding in the future.

##### Keys are stored in unpinned memory and not cleared after their lifetime

The problem here is that the memory with cryptographic keys can be swapped to the storage and potentially accessed by an attacked who has root level access to the device (or the level of access required to access swap file of the application). So, if you are running SimpleX Chat on desktop you could improve its security by running it in isolated container.

On mobile operating systems it is less severe as each application already runs in its own container, and applications do not share access to their swap areas (e.g., on Android swap is a [compressed area in RAM](https://developer.android.com/topic/performance/memory-management) not accessible to other applications).

To exploit this issue an attacker needs to have privileged system access on the device. Also, we believe [Haskell generational garbage collection](https://www.microsoft.com/en-us/research/wp-content/uploads/1993/01/gen-gc-for-haskell.pdf) makes the lifetime of unused memory lower than in other languages.

We will be addressing this issue in the near future, possibly by using library [secure-memory](https://hackage.haskell.org/package/secure-memory-0.0.0.2) created by Kirill Elagin, an engineer at Serokell or some similar approach.

### Low severity issues

#### The functions that do string padding and unpadding can throw exceptions

Both these issues are fixed in 4.2 in [this PR](https://github.com/simplex-chat/simplexmq/pull/547/files), with the additional unit tests, and we also validated that even before the fix the strings that would cause such exception were never passed to this function, so we could not find the possibility of the attack that would succeed because of this issue.

### What's next

There are areas of SimpleX Chat that were out of scope of this review, specifically:

- the chat protocol implementation and mobile UIs, as they includes no cryptography of networking (with the exception of Android app storing encrypted database passphrase and key exchange/encryption for WebRTC calls).
- push notifications server that is used by iOS clients.

We will be arranging to review these areas separately.

## The new website

TODO

## SimpleX Chat v4.2 released!

TODO

New in this release:

- fixed issues from the security audit!
- group links - group admins can create the links for new members to join
- auto-accept contact requests + configure whether to accept incognito and welcome message
- change group member role
- mark chat as unread

Beta features (enable Developer tools to try them):

- manually switch contact or member to another address / server (it has to be supported by both clients to work)
- receive files faster (enable it in Privacy & Security settings)
